## ğŸ¯ **PrioritÃ¤t 1: Robustheit & ZuverlÃ¤ssigkeit** (Kritisch)

### **1.1 Systematische Test-Suite erstellen** âœ… **ERLEDIGT (2025-10-11)**
**Problem:** 15+ Test-Skripte in scripts, aber keine systematische Test-Suite
**LÃ¶sung:**
```
âœ… Erstelle scripts/run_all_tests.py - fÃ¼hrt alle Tests automatisch aus â†’ DONE
ğŸ”² Erstelle scripts/test_suite.py - Pytest-basierte Test-Suite â†’ TODO (Sprint 1)
âœ… Tests fÃ¼r kritische Paths: â†’ 22/22 Tests vorhanden und bestehen
   - Window Detection (alle 4 Fenster-Typen) âœ…
   - Parsing Edge-Cases (OCR-Fehler, fehlende Preise, etc.) âœ…
   - Delta-Detection (DB-Check) âœ…
   - Timestamp-Cluster-Logik âœ…
   - Buy-Inferenz (identischer Unit-Price) âœ…
   - Historical Transaction Detection âœ…
```
**Status:** run_all_tests.py existiert und lÃ¤uft (22/22 passing), Pytest-Migration noch ausstehend
**Impact:** â­â­â­â­â­ - Basis fÃ¼r alle weiteren Verbesserungen

---

### **1.2 OCR-Fehler-Analyse & Monitoring** âš ï¸ **TEILWEISE (2025-10-11)**
**Problem:** OCR-Fehler kommen vor, aber keine systematische Analyse
**LÃ¶sung:**
```python
# scripts/analyze_ocr_errors.py â†’ TODO (Sprint 1 PrioritÃ¤t)
ğŸ”² Parse ocr_log.txt nach hÃ¤ufigen Fehlern
ğŸ”² Identifiziere Muster (z.B. "Oâ†’0", "Iâ†’1", "pleted")
ğŸ”² Erstelle Statistik: Welche Fehler kommen am hÃ¤ufigsten vor?
ğŸ”² Empfehle Preprocessing-Anpassungen basierend auf Daten
ğŸ”² Generiere Report mit Beispielen

# tracker.py Erweiterung
âœ… FÃ¼ge OCR-Confidence-Score hinzu (EasyOCR liefert das bereits) â†’ DONE (utils.py)
âœ… Logge niedrige Confidence-Werte fÃ¼r manuelle Review â†’ DONE (avg/min/max + Warnung <0.5)
ğŸ”² Optional: GUI-Warnung bei niedriger Confidence â†’ TODO
```
**Status:** Confidence-Logging implementiert, aber kein Analyse-Tool vorhanden
**Impact:** â­â­â­â­â­ - Direkte Verbesserung der DatenqualitÃ¤t

---

### **1.3 Duplikat-Detection hÃ¤rten** âš ï¸ **TEILWEISE ERLEDIGT**
**Problem:** DB-Delta-Check implementiert, aber Edge-Cases mÃ¶glich
**LÃ¶sung:**
```python
# database.py Erweiterung
ğŸ”² FÃ¼ge find_similar_transactions() hinzu: â†’ TODO (Sprint 2)
   - Suche nach "fast identischen" Transaktionen (Â±5% Preis, Â±1min Zeit)
   - Warne bei verdÃ¤chtigen Duplikaten
   - Optionale Auto-Merge-Logik

# tracker.py
âœ… Verbessere Signature-Logik: â†’ TEILWEISE DONE
   - âœ… Normalisiere Item-Namen (lowercase, stripped) â†’ DONE (utils.py::normalize_item_name)
   - âœ… DB-basierte Delta-Detection (statt nur Text-Baseline) â†’ DONE
   - âœ… Cluster-Building FIRST verhindert Split-Processing â†’ DONE (2025-10-11 Fix)
   - ğŸ”² Runde Preise auf sinnvolle Genauigkeit â†’ TODO
   - ğŸ”² Toleriere kleine Timestamp-Unterschiede (Â±30s) â†’ TODO
```
**Status:** Basis-Duplikat-Schutz implementiert (DB unique index + Delta-Check), aber erweiterte Fuzzy-Detection fehlt
**Impact:** â­â­â­â­ - Verhindert Datenverschmutzung

---

## ğŸ”§ **PrioritÃ¤t 2: StabilitÃ¤t & Error Handling**

### **2.1 Robustes Error Handling & Recovery** âœ… **ERLEDIGT (2025-10-11)**
**Problem:** try/except vorhanden, aber kein Recovery-Mechanismus
**LÃ¶sung:**
```python
# tracker.py
âœ… FÃ¼ge error_count und last_error hinzu â†’ DONE (tracker.py line 53)
âœ… Bei wiederholten OCR-Fehlern: â†’ TEILWEISE DONE
   - âœ… error_count erhÃ¶ht sich bei Fehlern â†’ DONE
   - âœ… Automatische Erholung (error_count -= 1 bei Erfolg) â†’ DONE
   - ğŸ”² Reduziere Poll-Interval temporÃ¤r â†’ TODO
   - âœ… Tesseract Fallback existiert â†’ DONE (utils.py)
   - âœ… Logge ausfÃ¼hrliche Debug-Info â†’ DONE
âœ… Bei DB-Fehlern: â†’ TEILWEISE DONE
   - âœ… Thread-safe connections â†’ DONE
   - ğŸ”² Retry-Logik mit Exponential Backoff â†’ TODO
   - ğŸ”² TemporÃ¤rer Fallback auf In-Memory-Queue â†’ TODO
   - ğŸ”² Auto-Recovery nach DB-Wiederherstellung â†’ TODO

# gui.py
âœ… Status-Indikator fÃ¼r Fehler (Rot/Gelb/GrÃ¼n) â†’ DONE (ğŸŸ¢ğŸŸ¡ğŸ”´ Ampel-System)
ğŸ”² Letzten Fehler in GUI anzeigen â†’ TODO
ğŸ”² Button "Retry Last Failed Operation" â†’ TODO
```
**Status:** Error-Tracking + Health-Indikator implementiert, aber erweiterte Recovery-Features fehlen
**Impact:** â­â­â­â­ - System lÃ¤uft auch bei Problemen weiter

---

### **2.2 Validierung & Sanity Checks** âš ï¸ **TEILWEISE ERLEDIGT**
**Problem:** Parsing akzeptiert teilweise unrealistische Werte
**LÃ¶sung:**
```python
# parsing.py
âœ… Erweitere Validierung: â†’ TEILWEISE DONE
   - âœ… Basis-Validierung: quantity > 0, price > 0 â†’ DONE
   - ğŸ”² Min/Max-Grenzen fÃ¼r Mengen (1-100000) â†’ TODO (derzeit nur > 0)
   - ğŸ”² Min/Max-Grenzen fÃ¼r Preise (configurable) â†’ TODO
   - âœ… Fuzzy-Matching fÃ¼r Item-Namen â†’ DONE (utils.py::correct_item_name)
   - ğŸ”² Item-Name-LÃ¤nge (3-100 Zeichen) â†’ TODO
   
ğŸ”² FÃ¼ge validation_report hinzu: â†’ TODO (Sprint 2)
   - Logge suspekte Transaktionen
   - Flag fÃ¼r "needs_manual_review"
   - GUI-Filter fÃ¼r "flagged" Transaktionen

# config.py
ğŸ”² Erweitere MIN_UNIT_PRICE/MAX_UNIT_PRICE per Item-Kategorie â†’ TODO
   (z.B. Saps: 1-100, Crystals: 100k-2B)
```
**Status:** Basis-Validierung vorhanden, aber erweiterte PlausibilitÃ¤ts-Checks fehlen
**Impact:** â­â­â­â­ - Weniger Garbage-Daten

---

## ğŸ“Š **PrioritÃ¤t 3: Monitoring & Diagnostics**

### **3.1 Health-Check & Metrics** âœ… **ERLEDIGT (2025-10-11)**
```python
# tracker.py
âœ… FÃ¼ge get_health_status() hinzu: â†’ DONE
   - âœ… error_count tracking â†’ DONE
   - âœ… Automatische Erholung bei Erfolg â†’ DONE
   - ğŸ”² OCR success rate (last 100 scans) â†’ TODO (derzeit nur error_count)
   - ğŸ”² Parse success rate â†’ TODO
   - ğŸ”² DB connection status â†’ TODO
   - ğŸ”² Last successful transaction timestamp â†’ TODO
   - ğŸ”² Window detection accuracy â†’ TODO
   
# gui.py
âœ… "System Health" Panel: â†’ DONE (Basis-Version)
   - âœ… Grafische Anzeige (Ampel-System ğŸŸ¢ğŸŸ¡ğŸ”´) â†’ DONE (gui.py line 78-98)
   - âœ… Update alle 500ms â†’ DONE
   - ğŸ”² Detaillierte Metrics on hover â†’ TODO
   - ğŸ”² Warnung bei Verschlechterung â†’ TODO
```
**Status:** Basis-Health-Indikator implementiert, aber erweiterte Metriken fehlen
**Impact:** â­â­â­ - FrÃ¼herkennung von Problemen

---

### **3.2 Structured Logging** ğŸ”² **TODO (Sprint 3)**
**Problem:** ocr_log.txt ist Plain-Text, schwer zu parsen
**LÃ¶sung:**
```python
ğŸ”² Erweitere Logging: â†’ TODO (Sprint 3)
   - JSON-Format fÃ¼r strukturierte Daten
   - Severity-Levels (DEBUG, INFO, WARN, ERROR)
   - Correlation-IDs fÃ¼r Transaction-Flow
   - Separate Log-Files (ocr.log, db.log, errors.log)
   
ğŸ”² scripts/analyze_logs.py: â†’ TODO
   - Parse strukturierte Logs
   - Generiere Reports
   - Filter nach Severity/Zeitraum
```
**Status:** Aktuell Plain-Text-Logging in ocr_log.txt
**Impact:** â­â­â­ - Bessere Diagnostics

---

## ğŸš€ **PrioritÃ¤t 4: Performance & Usability**

### **4.1 OCR-Performance optimieren** ğŸ”² **TODO (Sprint 3)**
```python
# utils.py
ğŸ”² Implementiere Caching: â†’ TODO
   - Cache preprocessed images (Hash-basiert)
   - Cache OCR-Ergebnisse fÃ¼r identische Screenshots
   - Verfallszeit: 5 Sekunden
   
ğŸ”² ROI-Detection verbessern: â†’ TODO
   - âœ… Basis-ROI bereits implementiert (DEFAULT_REGION) â†’ DONE
   - ğŸ”² Intelligentere Log-Region-Erkennung â†’ TODO
   - ğŸ”² Nur relevante Bereiche OCRen â†’ TODO
   - ğŸ”² Skip Header/Footer â†’ TODO
```
**Status:** Basis-Region funktioniert, aber kein Caching/intelligente ROI
**Impact:** â­â­â­ - Schnellere Scans

---

### **4.2 GUI-Verbesserungen** âš ï¸ **TEILWEISE ERLEDIGT**
```python
# gui.py
âš ï¸ Live-Statistiken: â†’ TEILWEISE DONE
   - âœ… Basis-Filter nach Item/Side/Type existiert â†’ DONE
   - âœ… Analyse-Plot-Button â†’ DONE
   - ğŸ”² Transaktionen heute/gestern/diese Woche â†’ TODO
   - ğŸ”² Profit/Loss (Buy vs Sell) â†’ TODO
   - ğŸ”² Top-Items â†’ TODO
   
ğŸ”² Quick-Filters: â†’ TODO
   - "Heute", "Diese Woche", "Letzter Monat"
   - "Nur KÃ¤ufe", "Nur VerkÃ¤ufe"
   - "Flagged" (suspekte Transaktionen)
   
âš ï¸ Verbesserte Fenster-Historie: â†’ TEILWEISE DONE
   - âœ… Live Window Status (window_status_var) â†’ DONE
   - ğŸ”² Timeline-Ansicht statt Messagebox â†’ TODO
   - ğŸ”² Farbcodierung (sell=grÃ¼n, buy=blau, detail=grau) â†’ TODO
```
**Status:** Basis-GUI funktioniert, aber erweiterte Statistiken/Filter fehlen
**Impact:** â­â­â­ - Bessere User Experience

---

## ğŸ“‹ **Empfohlene Reihenfolge:**

### **Sprint 1 (Woche 1): Fundament**
1. âœ… Systematische Test-Suite (1.1) - 2-3 Tage
2. âœ… OCR-Fehler-Analyse (1.2) - 1-2 Tage
3. âœ… Error Handling & Recovery (2.1) - 2 Tage

**Ziel:** Solide Basis fÃ¼r weitere Entwicklung

---

### **Sprint 2 (Woche 2): Robustheit**
1. âœ… Duplikat-Detection hÃ¤rten (1.3) - 1-2 Tage
2. âœ… Validierung & Sanity Checks (2.2) - 2 Tage
3. âœ… Health-Check & Metrics (3.1) - 1 Tag

**Ziel:** System ist selbst-Ã¼berwachend und robust

---

### **Sprint 3 (Woche 3): Polish**
1. âœ… Structured Logging (3.2) - 1-2 Tage
2. âœ… OCR-Performance (4.1) - 1-2 Tage
3. âœ… GUI-Verbesserungen (4.2) - 2 Tage

**Ziel:** System ist benutzerfreundlich und performant

---

## ğŸ¯ **Quick Wins** âœ… **ALLE ERLEDIGT (2025-10-11)**

### **A. OCR-Confidence in Log schreiben** âœ… **DONE**
```python
# utils.py - extract_text() lines 177-207
# âœ… EasyOCR mit detail=1 â†’ (bbox, text, confidence)
# âœ… Loggt: avg/min/max confidence
# âœ… Warnung bei <0.5: "âš ï¸ LOW CONFIDENCE"
```
â±ï¸ 15 Minuten, â­â­â­â­ Impact â†’ **ERLEDIGT**

---

### **B. GUI: Status-Indikator** âœ… **DONE**
```python
# gui.py lines 78-98
# âœ… health_status_var = "ğŸŸ¢ Healthy" | "ğŸŸ¡ Warning" | "ğŸ”´ Error"
# âœ… Update alle 500ms basierend auf error_count
# âœ… Farbcodierung: green/orange/red
```
â±ï¸ 30 Minuten, â­â­â­ Impact â†’ **ERLEDIGT**

---

### **C. Basic Test Runner** âœ… **DONE**
```python
# scripts/run_all_tests.py
# âœ… FÃ¼hrt alle test_*.py Dateien aus
# âœ… Sammelt Ergebnisse und zeigt Summary
# âœ… Unicode-Fix fÃ¼r Windows
# âœ… Aktuell: 22/22 Tests bestehen (100%)
```
â±ï¸ 20 Minuten, â­â­â­â­â­ Impact â†’ **ERLEDIGT**

---

## ğŸ’¡ **Aktueller Stand & Empfehlung (2025-10-12)**

### âœ… **ERLEDIGT:**
- Quick Wins A+B+C (OCR Confidence, Health Indikator, Test Runner)
- Test-Suite: 22/22 Tests bestehen (100%)
- Critical Fixes: Cluster-Building Refactor, Historical Detection V3
- Error Handling Basis: error_count tracking, automatische Erholung

### ğŸ¯ **NÃ„CHSTE SCHRITTE - Sprint 1 (diese Woche):**

1. **PRIORITÃ„T 1: Pytest-Migration** (2-3 Tage)
   - Erstelle `scripts/test_suite.py` mit pytest-basierter Suite
   - Organisiere Tests nach Kategorien (window_detection/, parsing/, etc.)
   - FÃ¼ge Coverage-Reporting hinzu
   - **Warum:** Bessere Test-Organisation, CI/CD-ready

2. **PRIORITÃ„T 2: OCR-Fehler-Analyse Tool** (1-2 Tage)
   - Erstelle `scripts/analyze_ocr_errors.py`
   - Parse ocr_log.txt nach Mustern
   - Generiere Statistik: hÃ¤ufigste Fehler, Confidence-Verteilung
   - Empfehle item_names.csv ErgÃ¤nzungen
   - **Warum:** DatenqualitÃ¤t direkt verbessern

3. **PRIORITÃ„T 3: GUI Enhancements** (1 Tag)
   - GUI-Warnung bei niedriger OCR Confidence
   - Letzten Fehler anzeigen
   - Quick-Filters (Heute/Woche/Monat)
   - **Warum:** Bessere User Experience

### ğŸ”„ **Sprint 2 (nÃ¤chste Woche):**
- Duplikat-Detection hÃ¤rten (find_similar_transactions)
- Erweiterte Validierung (Min/Max-Grenzen per Item-Kategorie)
- Detaillierte Health-Metrics (Success-Rates, DB-Status)

### ğŸš€ **Sprint 3 (danach):**
- Structured Logging (JSON-Format)
- OCR-Performance (Caching, intelligente ROI)
- GUI-Polish (Timeline, Statistiken, Profit/Loss)

---

